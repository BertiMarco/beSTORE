<!DOCTYPE HTML>  
<html>
<head>
<style>
.error {color: #FF0000;}
</style>
</head>

<body>
        <?php
        $servername = "localhost";
        $username = "xsigomft_bestore";
        $password = "bertistore;2019";
        $dbname = "xsigomft_bestore";
        
        $nameErr = $idErr = $marcaErr = $annoErr = $lunghezzaErr = $posizioneErr = "";
        $nome = $id = $marca = $anno = $lunghezza = $posizione = $descrizione = "";
        
        // Create connection
        $conn = new mysqli($servername, $username, $password, $dbname);
        // Check connection
        
        if ($conn->connect_error) {
            die("Connection failed: " . $conn->connect_error);
        } 
        //echo "Connessione riuscita</br>";
        
        if($_SERVER["REQUEST_METHOD"] == "POST") {
            if(empty($_POST['id'])) {
                $nameErr = "Richiesto";
            }
            else {
                $id = test_input($_POST['id']);
            }
        }
        
        if($_SERVER["REQUEST_METHOD"] == "POST") {
            if(empty($_POST['name'])) {
                $nameErr = "Richiesto";
            }
            else {
                $id = test_input($_POST['name']);
            }
        }
        
        if($_SERVER["REQUEST_METHOD"] == "POST") {
            if(empty($_POST['brand'])) {
                $marca = "";
            }
            else {
                $marca = test_input($_POST['brand']);
            }
        }
        
        if($_SERVER["REQUEST_METHOD"] == "POST") {
            if(empty($_POST['year'])) {
                $anno = "";
            }
            else {
                $anno = test_input($_POST['year']);
            }
        }
        
        if($_SERVER["REQUEST_METHOD"] == "POST") {
            if(empty($_POST['length'])) {
                $lunghezza = "";
            }
            else {
                $lunghezza = test_input($_POST['length']);
            }
        }
        
        if($_SERVER["REQUEST_METHOD"] == "POST") {
            if(empty($_POST['location'])) {
                $posizioneErr = "Richiesto";
            }
            else {
                $posizione = test_input($_POST['location']);
            }
        }
        
        if($_SERVER["REQUEST_METHOD"] == "POST") {
            if(empty($_POST['description'])) {
                $descrizione = "";
            }
            else {
                $descrizione = test_input($_POST['description']);
            }
        }

        $pwd = test_input($_POST['pwd']);   
        
        if($pwd !== "password") {
            $pwdErr = "Password errata!";
        }
        else {
            $sql = 'SELECT id FROM oggetto WHERE id = ?';
            $stmt = $conn->prepare($sql);
            $stmt->bind_param($id);
            $stmt->execute();
            $stmt->fetch();
            if($stmt->num_rows >=1) {
                //id giÃ  presente.
            }
            else {
                //fare INSERT
            }


        }
        
        
        $sql = 'INSERT INTO prestito (id_oggetto, imei_utente, preso_il, evento) VALUES (?, ?, ?, ?)';
        $stmt = $conn->prepare($sql);
        $done = TRUE;
        foreach($itemsArray as $item) {
            $stmt->bind_param("ssss", $item, $imei, $date, $evento);
            if(!$stmt->execute())
                $done = FALSE;
        }
        if($done)
            echo "ok";
        else
            echo "ko";
        $stmt->close();
        $conn->close();
        
        function test_input($data) {
            $data = trim($data);
            $data = stripslashes($data);
            $data = htmlspecialchars($data);
            return $data;
          }
        
        ?>

    <form method="post" action="<?php echo htmlspecialchars($_SERVER["PHP_SELF"]);?>">
        ID: <input type="text" name="id" value="<?php echo $id;?>">
        <span class="error">* <?php echo $idErr;?></span>
        <br><br>
        Nome: <input type="text" name="name" value="<?php echo $nome:?>">
        <span class="error">* <?php echo $nameErr;?></span>
        <br><br>
        Marca: <input type="text" name="brand" value="<?php echo $marca:?>">
        <br><br>
        Anno: <input type="text" name="year" value="<?php echo $anno:?>">
        <br><br>
        Lunghezza: <input type="text" name="length" value="<?php echo $lunghezza:?>">
        <br><br>
        Posizione: <input type="text" name="location" value="<?php echo $posizione:?>">
        <span class="error">* <?php echo $posizioneErr;?></span>
        <br><br>
        Descrizione: <textarea name="description" rows="5" cols="40" value="<?php echo $descrizione:?>">
        <br><br>


        ----------------------------------------------------------<br>
        PASSWORD: <input type="password" name="pwd">
        <span class="error">* <?php echo $pwdErr;?></span>

        <input type="submit">
    </form>

</body>

</html>